<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>迎财神</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet" />
    <style>
        :root {
            --bg-a: #1c1b3b;
            --bg-b: #411617;
            --gold: #ffd85a;
            --gold-deep: #f3a500;
            --red: #bf1e2e;
            --red-deep: #7f1322;
            --ink: #2f1f14;
            --door-w: min(52vw, 340px);
            --door-h: min(66vw, 420px);
            --ease: cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            min-height: 100vh;
            display: grid;
            place-items: center;
            overflow: hidden;
            font-family: "ZCOOL KuaiLe", "PingFang SC", sans-serif;
            color: #fff6d4;
            background:
                radial-gradient(circle at 18% 10%, #ffdb7a40 0%, transparent 32%),
                radial-gradient(circle at 86% 18%, #ff7d4745 0%, transparent 30%),
                linear-gradient(150deg, var(--bg-a), var(--bg-b) 60%, #120f25);
        }
        .scene {
            width: min(1080px, 100vw);
            height: min(760px, 100vh);
            position: relative;
            isolation: isolate;
            overflow: hidden;
        }
        .scene::before {
            content: "";
            position: absolute;
            inset: 8% 12%;
            background:
                radial-gradient(circle at center, #ffd85a4a, transparent 62%),
                repeating-linear-gradient(
                    45deg,
                    #ffffff0f 0 10px,
                    #ffffff00 10px 20px
                );
            filter: blur(1px);
            opacity: 0.55;
            z-index: -1;
        }
        .title {
            position: absolute;
            top: 4%;
            width: 100%;
            text-align: center;
            font-family: "Ma Shan Zheng", "STKaiti", cursive;
            font-size: clamp(2rem, 5vw, 3.5rem);
            letter-spacing: 0.08em;
            text-shadow: 0 0 16px #ffda68b0;
            opacity: 0;
            transform: translateY(-12px);
            transition: 800ms var(--ease);
        }
        body.phase-enter .title,
        body.phase-give .title {
            opacity: 1;
            transform: translateY(0);
        }
        .ground {
            position: absolute;
            left: 50%;
            bottom: 11%;
            width: min(92vw, 920px);
            height: clamp(84px, 15vw, 140px);
            transform: translateX(-50%);
            border-radius: 50%;
            background: radial-gradient(circle at center, #ffcf5d34, #00000000 72%);
            filter: blur(2px);
        }
        .house {
            position: absolute;
            left: 50%;
            bottom: 16%;
            width: var(--door-w);
            height: var(--door-h);
            transform: translateX(-50%);
        }
        .door-frame {
            position: absolute;
            inset: 0;
            border: 10px solid #e3a51f;
            border-radius: 18px;
            background: linear-gradient(#6b1b1f, #551017);
            box-shadow: 0 24px 36px #00000055, inset 0 0 0 8px #c93440;
            overflow: hidden;
        }
        .door-side {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            background: linear-gradient(180deg, #bf2534, #8f1a2a);
            border: 3px solid #d99f24;
            transition: transform 1300ms var(--ease);
            will-change: transform;
        }
        .door-left {
            left: 0;
            transform-origin: left center;
        }
        .door-right {
            right: 0;
            transform-origin: right center;
        }
        .door-pattern {
            position: absolute;
            inset: 14% 10%;
            border-radius: 8px;
            border: 2px solid #f8d273;
            display: grid;
            place-items: center;
            color: #ffe799;
            font-size: clamp(1rem, 2.8vw, 1.8rem);
            text-shadow: 0 0 8px #00000066;
        }
        .knocker {
            position: absolute;
            top: 50%;
            width: 16px;
            aspect-ratio: 1;
            border-radius: 50%;
            background: radial-gradient(circle at 28% 20%, #fff2b0, #d08d00);
            box-shadow: 0 0 0 5px #c48307;
            transform: translateY(-50%);
        }
        .door-left .knocker {
            right: 14%;
        }
        .door-right .knocker {
            left: 14%;
        }
        body.phase-knock .door-frame {
            animation: knock-door 0.45s ease-in-out 0s 5;
        }
        body.phase-open .door-left,
        body.phase-enter .door-left,
        body.phase-give .door-left {
            transform: perspective(800px) rotateY(-108deg);
        }
        body.phase-open .door-right,
        body.phase-enter .door-right,
        body.phase-give .door-right {
            transform: perspective(800px) rotateY(108deg);
        }
        .knock-text {
            position: absolute;
            left: 50%;
            bottom: calc(16% + var(--door-h) + 12px);
            transform: translateX(-50%);
            background: #3b1f1399;
            border: 2px solid #ffde7f;
            border-radius: 999px;
            padding: 10px 18px;
            font-size: clamp(1rem, 2.5vw, 1.6rem);
            opacity: 0;
            letter-spacing: 0.12em;
        }
        body.phase-knock .knock-text {
            opacity: 1;
            animation: pulse 0.55s ease-in-out 0s 5;
        }
        .caishen {
            position: absolute;
            left: calc(50% + min(40vw, 265px));
            bottom: 16%;
            width: min(30vw, 220px);
            aspect-ratio: 0.8;
            transform: translateX(0);
            transition: transform 2000ms var(--ease);
            filter: drop-shadow(0 14px 20px #00000075);
        }
        body.phase-enter .caishen,
        body.phase-give .caishen {
            transform: translateX(calc(-1 * min(37vw, 240px)));
        }
        .body {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 76%;
            border-radius: 22% 22% 16% 16%;
            background: linear-gradient(180deg, #dc2c2e, #992323);
            border: 5px solid #f4c03f;
        }
        .belly {
            position: absolute;
            left: 50%;
            top: 38%;
            transform: translateX(-50%);
            width: 56%;
            height: 42%;
            border-radius: 50%;
            background: radial-gradient(circle at 50% 26%, #ffeaa3, #f6c54c);
            border: 4px solid #ac6b0f;
            display: grid;
            place-items: center;
            color: #9b141b;
            font-size: clamp(1.1rem, 3.4vw, 2rem);
            font-weight: 700;
        }
        .head {
            position: absolute;
            left: 50%;
            top: -6%;
            transform: translateX(-50%);
            width: 66%;
            aspect-ratio: 1.05;
            border-radius: 50%;
            background: #ffd9a4;
            border: 5px solid #c37f40;
        }
        .hat {
            position: absolute;
            left: 50%;
            top: -14%;
            transform: translateX(-50%);
            width: 95%;
            height: 24%;
            border-radius: 999px;
            background: linear-gradient(180deg, #111, #2f2f2f);
            border: 3px solid #f2cc58;
        }
        .eye {
            position: absolute;
            top: 45%;
            width: 13%;
            height: 8%;
            border-radius: 999px;
            background: #4d2b18;
        }
        .eye.left {
            left: 26%;
        }
        .eye.right {
            right: 26%;
        }
        .moustache {
            position: absolute;
            left: 50%;
            bottom: 18%;
            width: 58%;
            height: 18%;
            transform: translateX(-50%);
            border-bottom: 6px solid #6a3117;
            border-radius: 0 0 50% 50%;
        }
        .arm {
            position: absolute;
            top: 42%;
            width: 34%;
            height: 16%;
            border-radius: 999px;
            background: #c91f2b;
            border: 4px solid #f2c143;
            transform-origin: 12% 50%;
        }
        .arm.left {
            left: -14%;
            transform: rotate(22deg);
        }
        .arm.right {
            right: -18%;
            transform: rotate(-28deg);
            transform-origin: 92% 50%;
            animation: knock-hand 0.45s ease-in-out 0s 5;
            animation-play-state: paused;
        }
        body.phase-knock .arm.right {
            animation-play-state: running;
        }
        .yuanbao {
            position: absolute;
            right: -26%;
            top: 53%;
            width: 44%;
            height: 20%;
            border-radius: 56% 56% 42% 42%;
            background: linear-gradient(180deg, #ffe07e, #efad20);
            border: 4px solid #b17708;
            display: grid;
            place-items: center;
            color: #8c1c1c;
            font-size: clamp(0.8rem, 2vw, 1.2rem);
            box-shadow: 0 8px 12px #00000045;
            transform: translateY(8px);
            opacity: 0;
            transition: 600ms var(--ease);
        }
        body.phase-give .yuanbao {
            transform: translateY(0);
            opacity: 1;
        }
        .ingots {
            position: absolute;
            left: 50%;
            bottom: 28%;
            width: min(78vw, 860px);
            height: 48%;
            transform: translateX(-50%);
            pointer-events: none;
        }
        .ingot {
            position: absolute;
            left: 50%;
            bottom: 12%;
            width: clamp(26px, 5vw, 52px);
            aspect-ratio: 1.18;
            border-radius: 44% 44% 52% 52%;
            background: linear-gradient(180deg, #ffe083, #ecab1e);
            border: 3px solid #9f6708;
            opacity: 0;
            transform: translate(-50%, 0) scale(0.5);
        }
        body.phase-give .ingot {
            animation: fly var(--dur) var(--delay) var(--ease) forwards;
        }
        .blessing {
            position: absolute;
            left: 50%;
            bottom: 8%;
            transform: translateX(-50%) translateY(10px);
            width: min(90vw, 860px);
            text-align: center;
            font-size: clamp(1.2rem, 3vw, 2rem);
            color: #ffe8a6;
            text-shadow: 0 0 12px #8d2e05;
            opacity: 0;
            transition: 800ms var(--ease);
        }
        body.phase-give .blessing {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        .replay {
            position: absolute;
            right: min(4vw, 28px);
            bottom: min(4vw, 24px);
            border: 2px solid #ffde84;
            background: #4e1219db;
            color: #ffe89e;
            font: inherit;
            padding: 10px 14px;
            border-radius: 12px;
            cursor: pointer;
            transition: 220ms ease;
        }
        .replay:hover {
            transform: translateY(-2px);
            background: #6e1723;
        }
        @keyframes knock-door {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }
        @keyframes knock-hand {
            0%, 100% { transform: rotate(-28deg); }
            50% { transform: rotate(-42deg) translateX(-6px); }
        }
        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.07); }
        }
        @keyframes fly {
            0% { opacity: 0; transform: translate(-50%, 0) scale(0.3); }
            15% { opacity: 1; }
            100% { opacity: 0; transform: translate(calc(-50% + var(--x)), calc(-1 * var(--y))) rotate(var(--r)) scale(1); }
        }
        @media (max-width: 768px) {
            .scene { height: 100vh; }
            .house { bottom: 20%; }
            .caishen { width: min(38vw, 210px); bottom: 20%; }
            .ingots { bottom: 34%; }
        }
    </style>
</head>
<body>
    <main class="scene">
        <h1 class="title">初五迎财神</h1>
        <div class="ground"></div>
        <section class="house" aria-label="大门">
            <div class="door-frame">
                <div class="door-side door-left">
                    <div class="door-pattern">福</div>
                    <span class="knocker"></span>
                </div>
                <div class="door-side door-right">
                    <div class="door-pattern">财</div>
                    <span class="knocker"></span>
                </div>
            </div>
        </section>
        <p class="knock-text">咚 咚 咚</p>
        <section class="caishen" aria-label="财神角色">
            <div class="body">
                <div class="belly">财</div>
            </div>
            <div class="arm left"></div>
            <div class="arm right"></div>
            <div class="yuanbao">金元宝</div>
            <div class="head">
                <div class="hat"></div>
                <div class="eye left"></div>
                <div class="eye right"></div>
                <div class="moustache"></div>
            </div>
        </section>
        <div class="ingots" aria-hidden="true">
            <span class="ingot" style="--x:-300px; --y:170px; --r:-18deg; --dur:1400ms; --delay:40ms;"></span>
            <span class="ingot" style="--x:-200px; --y:210px; --r:-10deg; --dur:1700ms; --delay:120ms;"></span>
            <span class="ingot" style="--x:-100px; --y:160px; --r:-4deg; --dur:1200ms; --delay:200ms;"></span>
            <span class="ingot" style="--x:10px; --y:210px; --r:3deg; --dur:1600ms; --delay:280ms;"></span>
            <span class="ingot" style="--x:120px; --y:170px; --r:8deg; --dur:1350ms; --delay:360ms;"></span>
            <span class="ingot" style="--x:220px; --y:220px; --r:14deg; --dur:1750ms; --delay:460ms;"></span>
            <span class="ingot" style="--x:300px; --y:180px; --r:22deg; --dur:1450ms; --delay:560ms;"></span>
        </div>
        <p class="blessing">财神登门，金银满屋，鸿运当头！</p>
        <button class="replay" id="replayBtn" type="button">再迎一次</button>
    </main>
    <script>
        // ===== 音效系统 =====
        let audioCtx = null;
        
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }
        
        // 敲门声
        function playKnock() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = 80;
            osc.type = 'square';
            gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gain.gain.exponentialDecayTo = 0.01;
            gain.gain.setTargetAtTime(0.01, audioCtx.currentTime, 0.05);
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + 0.15);
        }
        
        // 开门声（吱呀声）
        function playDoorOpen() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(400, audioCtx.currentTime + 0.3);
            osc.type = 'sawtooth';
            gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gain.gain.setTargetAtTime(0.01, audioCtx.currentTime + 0.2, 0.1);
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + 0.5);
        }
        
        // 金币声
        function playCoin() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(1200, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1800, audioCtx.currentTime + 0.1);
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.setTargetAtTime(0.01, audioCtx.currentTime + 0.1, 0.05);
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + 0.3);
        }
        
        // 连续金币声
        function playCoins() {
            for (let i = 0; i < 7; i++) {
                setTimeout(() => playCoin(), i * 150 + Math.random() * 100);
            }
        }
        
        // 喜庆音效（和弦）
        function playFestive() {
            if (!audioCtx) return;
            const notes = [523, 659, 784]; // C5, E5, G5 和弦
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.value = freq;
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
                gain.gain.setTargetAtTime(0.01, audioCtx.currentTime + 0.5, 0.3);
                osc.start(audioCtx.currentTime);
                osc.stop(audioCtx.currentTime + 1.5);
            });
        }
        
        // 财神祝福音
        function playBlessing() {
            if (!audioCtx) return;
            // 播放一个上行的琶音
            const notes = [392, 523, 659, 784]; // G4, C5, E5, G5
            notes.forEach((freq, i) => {
                setTimeout(() => {
                    const osc = audioCtx.createOscillator();
                    const gain = audioCtx.createGain();
                    osc.connect(gain);
                    gain.connect(audioCtx.destination);
                    osc.frequency.value = freq;
                    osc.type = 'triangle';
                    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gain.gain.setTargetAtTime(0.01, audioCtx.currentTime + 0.3, 0.15);
                    osc.start(audioCtx.currentTime);
                    osc.stop(audioCtx.currentTime + 0.5);
                }, i * 120);
            });
        }
        
        // ===== 动画控制 =====
        const phases = ["phase-knock", "phase-open", "phase-enter", "phase-give"];
        const timeline = [0, 2200, 3000, 5000];
        let timers = [];
        
        function clearPhases() {
            phases.forEach((name) => document.body.classList.remove(name));
        }
        
        function playStory() {
            initAudio();
            timers.forEach((id) => clearTimeout(id));
            timers = [];
            clearPhases();
            
            timeline.forEach((time, index) => {
                const phaseName = phases[index];
                timers.push(
                    setTimeout(() => {
                        document.body.classList.add(phaseName);
                        
                        // 播放对应音效
                        if (phaseName === 'phase-knock') {
                            // 敲门声 5 次
                            for (let i = 0; i < 5; i++) {
                                setTimeout(playKnock, i * 450);
                            }
                        } else if (phaseName === 'phase-open') {
                            playDoorOpen();
                        } else if (phaseName === 'phase-give') {
                            playCoins();
                            playFestive();
                            setTimeout(playBlessing, 500);
                        }
                    }, time)
                );
            });
        }
        
        document.getElementById("replayBtn").addEventListener("click", playStory);
        
        // 首次点击任意位置初始化音频并播放
        let firstClick = true;
        document.addEventListener('click', () => {
            if (firstClick) {
                firstClick = false;
                playStory();
            }
        }, { once: true });
    </script>
</body>
</html>